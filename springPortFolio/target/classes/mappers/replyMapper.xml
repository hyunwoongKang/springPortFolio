<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="org.test.mapper.ReplyMapper">
  
  <!-- 모든 댓글 가져오기 -->
  <select id="getAllReply" resultType="ReplyVO">
  	select rno,bno,replytext,replyer,updatedate,b.user_image
	from (select rno,bno,replytext,replyer,updatedate,row_number() over(order by updatedate)r from tbl_reply where bno=#{bno}) a,tbl_user b
	where r between #{pk.pageStart} and #{pk.perPageNum}*#{pk.page} and a.replyer=b.nickname
  </select>
  
  <!-- 댓글 추가하기 -->
  <insert id="addReply">
  	insert into tbl_reply(bno,rno,replyText,replyer)
  	values(#{bno},reply_rno.nextval,#{replyText},#{replyer})
  </insert>
  
  <!-- 댓글 삭제하기 -->
  <delete id="removeReply">
  	delete from tbl_reply
  	where rno=#{rno}
  </delete>
  
  <!-- 댓글 수정하기 -->
  <update id="updateReply">
  	update tbl_reply
  	set replyText=#{replyText}
  	where bno=#{bno} and rno=#{rno} and replyer=#{replyer}
  </update>
  
  
  <!-- 해당 게시판 댓글 총 개수 가져오기 --> 
  <select id="countRno" resultType="int">
  select count(*)
  from tbl_reply
  where bno=#{bno}
  </select>
  
  </mapper>
  
  